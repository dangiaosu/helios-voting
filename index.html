}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 20px;
}

.container {
max-width: 900px;
margin: 0 auto;
}

.header-bar {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

h1 {
color: white;
text-align: center;
font-size: 2.5em;
text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
flex: 1;
}

.lang-switcher {
display: flex;
gap: 5px;
background: rgba(255, 255, 255, 0.2);
border-radius: 25px;
padding: 5px;
backdrop-filter: blur(10px);
}

.lang-btn {
padding: 8px 16px;
border: none;
border-radius: 20px;
cursor: pointer;
font-weight: bold;
transition: all 0.3s;
background: transparent;
color: white;
}

.lang-btn.active {
background: white;
color: #667eea;
}

.lang-btn:hover:not(.active) {
background: rgba(255, 255, 255, 0.1);
}

.tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
background: rgba(255, 255, 255, 0.1);
border-radius: 15px;
padding: 5px;
}

.tab-btn {
flex: 1;
padding: 15px;
border: none;
border-radius: 10px;
cursor: pointer;
font-weight: bold;
transition: all 0.3s;
background: transparent;
color: white;
font-size: 16px;
}

.tab-btn.active {
background: white;
color: #667eea;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.tab-btn:hover:not(.active) {
background: rgba(255, 255, 255, 0.15);
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.card {
background: white;
border-radius: 15px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.btn {
width: 100%;
padding: 15px;
font-size: 18px;
font-weight: bold;
border: none;
border-radius: 10px;
cursor: pointer;
margin: 10px 0;
transition: all 0.3s;
}

.btn-primary {
background: #4CAF50;
color: white;
}

.btn-primary:hover {
background: #45a049;
transform: translateY(-2px);
}

.btn-secondary {
background: #2196F3;
color: white;
}

.btn-secondary:hover {
background: #0b7dda;
}

.btn:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
}

.form-group {
margin-bottom: 20px;
}

.form-label {
display: block;
margin-bottom: 8px;
font-weight: bold;
color: #333;
}

.form-input,
.form-textarea,
.form-select {
width: 100%;
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 8px;
font-size: 16px;
transition: border 0.3s;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
outline: none;
border-color: #667eea;
}

.form-textarea {
min-height: 120px;
resize: vertical;
font-family: inherit;
}

.form-hint {
font-size: 14px;
color: #666;
margin-top: 5px;
}

.proposal-card {
background: #f8f9fa;
border: 2px solid #e0e0e0;
border-radius: 10px;
padding: 20px;
margin: 15px 0;
transition: all 0.3s;
}

.proposal-card:hover {
border-color: #667eea;
box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
}

.proposal-card.votable {
border-color: #4CAF50;
background: #f1f8f4;
}

.proposal-card.voted {
border-color: #2e7d32;
background: #f1f8f4;
}

.proposal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}

.proposal-id {
font-size: 1.2em;
font-weight: bold;
color: #667eea;
}

.status-badge {
padding: 5px 15px;
border-radius: 20px;
font-size: 0.85em;
font-weight: bold;
}

.status-voting {
background: #4CAF50;
color: white;
}

.status-passed {
background: #2196F3;
color: white;
}

.status-rejected {
background: #f44336;
color: white;
}

.status-other {
background: #9e9e9e;
color: white;
}

.proposal-title {
font-size: 1.1em;
margin: 10px 0;
color: #333;
}

.vote-options {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 10px;
margin-top: 15px;
}

.vote-btn {
padding: 10px;
border: none;
border-radius: 8px;
cursor: pointer;
font-weight: bold;
transition: all 0.3s;
font-size: 14px;
}

.vote-yes {
background: #4CAF50;
color: white;
}

.vote-yes:hover:not(:disabled) {
background: #45a049;
transform: scale(1.05);
}

.vote-no {
background: #f44336;
color: white;
}

.vote-no:hover:not(:disabled) {
background: #da190b;
transform: scale(1.05);
}

.vote-abstain {
background: #ff9800;
color: white;
}

.vote-abstain:hover:not(:disabled) {
background: #e68900;
transform: scale(1.05);
}

.vote-veto {
background: #9c27b0;
color: white;
}

.vote-veto:hover:not(:disabled) {
background: #7b1fa2;
transform: scale(1.05);
}

.vote-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
transform: none;
}

.voted-badge {
margin-top: 15px;
padding: 15px;
background: #e8f5e9;
border: 2px solid #4CAF50;
border-radius: 10px;
}

.voted-badge-header {
font-weight: bold;
color: #2e7d32;
margin-bottom: 8px;
font-size: 16px;
}

.voted-badge-option {
color: #1b5e20;
font-size: 15px;
margin: 5px 0;
}

.voted-badge-tx {
font-size: 13px;
color: #666;
margin-top: 8px;
}

.wallet-info {
background: linear-gradient(135deg, #667eea, #764ba2);
color: white;
padding: 20px;
border-radius: 10px;
margin-bottom: 20px;
}

.status {
padding: 15px;
border-radius: 10px;
margin: 15px 0;
line-height: 1.6;
}

.status-success {
background: #e8f5e9;
border-left: 4px solid #4CAF50;
}

.status-error {
background: #ffebee;
border-left: 4px solid #f44336;
}

.status-info {
background: #e3f2fd;
border-left: 4px solid #2196F3;
}

.loading {
text-align: center;
padding: 20px;
}

.spinner {
border: 4px solid #f3f3f3;
border-top: 4px solid #667eea;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin: 0 auto;
}

@keyframes spin {
0% {
transform: rotate(0deg);
}

100% {
transform: rotate(360deg);
}
}

.network-badge {
display: inline-block;
padding: 5px 10px;
background: #4CAF50;
color: white;
border-radius: 5px;
font-size: 0.85em;
margin-left: 10px;
}

.link {
color: #667eea;
text-decoration: none;
font-weight: bold;
}

.link:hover {
text-decoration: underline;
}
</style>
</head>

<body>
    <div class="container">
        <div class="header-bar">
            <div style="width: 100px;"></div>
            <h1>üó≥Ô∏è <span id="pageTitle">Helios Governance Portal</span></h1>
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="en" onclick="switchLanguage('en')">EN</button>
                <button class="lang-btn" data-lang="vi" onclick="switchLanguage('vi')">VN</button>
            </div>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 15px;" id="walletTitle">üîê Wallet Connection</h2>
            <button id="connectBtn" class="btn btn-primary" onclick="connectWallet()">Connect Wallet</button>
            <div id="walletInfo"></div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('vote')" id="tabVote">üó≥Ô∏è Vote</button>
            <button class="tab-btn" onclick="switchTab('create')" id="tabCreate">‚ú® Create Proposal</button>
        </div>

        <!-- Vote Tab -->
        <div id="voteTab" class="tab-content active">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 id="proposalsTitle">üìã Governance Proposals</h2>
                    <button id="refreshBtn" class="btn btn-secondary" onclick="loadProposals()"
                        style="width: auto; padding: 10px 20px;" disabled>üîÑ <span
                            id="refreshText">Refresh</span></button>
                </div>
                <div id="proposalsContainer">
                    <div style="text-align: center; padding: 40px; color: #999;" id="proposalPlaceholder">
                        üëÜ Connect wallet to view proposals
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Proposal Tab -->
        <div id="createTab" class="tab-content">
            <div class="card">
                <h2 id="createTitle" style="margin-bottom: 20px;">‚ú® Create New Proposal</h2>

                <div class="form-group">
                    <label class="form-label" id="labelProposalType">Proposal Type</label>
                    <select class="form-select" id="proposalType">
                        <option value="text">Text Proposal</option>
                    </select>
                    <div class="form-hint" id="hintProposalType">Standard governance text proposal</div>
                </div>

                <div class="form-group">
                    <label class="form-label" id="labelTitle">Title *</label>
                    <input type="text" class="form-input" id="proposalTitle" placeholder="Enter proposal title"
                        maxlength="200">
                    <div class="form-hint" id="hintTitle">Max 200 characters</div>
                </div>

                <div class="form-group">
                    <label class="form-label" id="labelDescription">Description *</label>
                    <textarea class="form-textarea" id="proposalDescription"
                        placeholder="Enter detailed description of your proposal"></textarea>
                    <div class="form-hint" id="hintDescription">Explain your proposal in detail</div>
                </div>

                <div class="form-group">
                    <label class="form-label" id="labelDeposit">Initial Deposit (HLS) *</label>
                    <input type="number" class="form-input" id="proposalDeposit" placeholder="10" min="1" step="0.1"
                        value="10">
                    <div class="form-hint" id="hintDeposit">Minimum deposit required to submit proposal</div>
                </div>

                <button class="btn btn-primary" id="submitProposalBtn" onclick="createProposal()" disabled>
                    <span id="submitText">Submit Proposal</span>
                </button>
            </div>
        </div>

        <div id="statusMessages"></div>
    </div>

    <script>
        let provider, signer, walletAddress;
        let currentLang = localStorage.getItem('helios-lang') || 'en';
        let currentTab = 'vote';
        let voteHistory = {};

        // Vote History Functions
        function getVoteStorageKey() {
            if (!walletAddress) return null;
            return `helios-votes-${walletAddress.toLowerCase()}`;
        }

        function loadVoteHistory() {
            const key = getVoteStorageKey();
            if (!key) return {};
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : {};
        }

        function saveVote(proposalId, option, txHash) {
            const key = getVoteStorageKey();
            if (!key) return;

            const optionNames = ['', 'YES', 'ABSTAIN', 'NO', 'VETO'];
            voteHistory[proposalId] = {
                option,
                txHash,
                timestamp: Date.now(),
                optionName: optionNames[option]
            };
            localStorage.setItem(key, JSON.stringify(voteHistory));
        }

        function hasVoted(proposalId) {
            return voteHistory[proposalId] !== undefined;
        }

        const translations = {
            en: {
                pageTitle: 'Helios Governance Portal',
                walletTitle: 'üîê Wallet Connection',
                connectBtn: 'Connect Wallet',
                connecting: '‚è≥ Connecting...',
                connected: '‚úÖ Connected',
                tabVote: 'üó≥Ô∏è Vote',
                tabCreate: '‚ú® Create Proposal',
                proposalsTitle: 'üìã Governance Proposals',
                refreshText: 'Refresh',
                proposalPlaceholder: 'üëÜ Connect wallet to view proposals',
                createTitle: '‚ú® Create New Proposal',
                labelProposalType: 'Proposal Type',
                labelTitle: 'Title *',
                labelDescription: 'Description *',
                labelDeposit: 'Initial Deposit (HLS) *',
                hintProposalType: 'Standard governance text proposal',
                hintTitle: 'Max 200 characters',
                hintDescription: 'Explain your proposal in detail',
                hintDeposit: 'Minimum deposit required to submit proposal',
                submitText: 'Submit Proposal',
                submitting: '‚è≥ Submitting...',
                loading: 'Loading proposals...',
                noProposals: 'No Proposals',
                noProposalsDesc: 'There are currently no governance proposals.',
                votingEnded: 'Voting ended',
                voteSuccess: 'VOTE SUCCESSFUL!',
                proposalSuccess: 'PROPOSAL CREATED!',
                proposal: 'Proposal',
                vote: 'Vote',
                alreadyVoted: '‚úÖ Already Voted',
                yourVote: 'Your Vote',
                viewTx: 'View TX',
                checkDashboard: 'Check Dashboard',
                tagUnlock: 'PROPOSAL_MASTER tag will unlock within 1-24h!',
                errorMetaMask: '‚ùå MetaMask not installed!<br>Download at: <a href="https://metamask.io" target="_blank" class="link">metamask.io</a>',
                errorConnect: '‚ùå Connection error',
                switchingNetwork: '‚è≥ Switching to Helios network...',
                errorAddNetwork: '‚ùå Cannot add Helios network',
                errorSwitchNetwork: '‚ùå Cannot switch network',
                walletConnected: '‚úÖ Wallet Connected',
                balance: 'üí∞ Balance',
                txSent: '‚è≥ Transaction sent! TX Hash',
                waitingConfirm: 'Waiting for confirmation...',
                sending: '‚è≥ Sending vote',
                creatingProposal: '‚è≥ Creating proposal',
                for: 'for',
                errorVote: '‚ùå Vote error',
                errorProposal: '‚ùå Proposal creation error',
                checkGas: 'üí° Check if wallet has enough HLS for gas',
                connectFirst: '‚ùå Please connect wallet first!',
                fillRequired: '‚ùå Please fill all required fields!',
                loaded: '‚úÖ Loaded',
                proposals: 'proposals',
                errorLoading: '‚ùå Error loading proposals'
            },
            vi: {
                pageTitle: 'C·ªïng Qu·∫£n Tr·ªã Helios',
                walletTitle: 'üîê K·∫øt N·ªëi V√≠',
                connectBtn: 'K·∫øt N·ªëi V√≠',
                connecting: '‚è≥ ƒêang k·∫øt n·ªëi...',
                connected: '‚úÖ ƒê√£ K·∫øt N·ªëi',
                tabVote: 'üó≥Ô∏è B·ªè Phi·∫øu',
                tabCreate: '‚ú® T·∫°o ƒê·ªÅ Xu·∫•t',
                proposalsTitle: 'üìã ƒê·ªÅ Xu·∫•t Qu·∫£n Tr·ªã',
                refreshText: 'L√†m M·ªõi',
                proposalPlaceholder: 'üëÜ K·∫øt n·ªëi v√≠ ƒë·ªÉ xem ƒë·ªÅ xu·∫•t',
                createTitle: '‚ú® T·∫°o ƒê·ªÅ Xu·∫•t M·ªõi',
                labelProposalType: 'Lo·∫°i ƒê·ªÅ Xu·∫•t',
                labelTitle: 'Ti√™u ƒê·ªÅ *',
                labelDescription: 'M√¥ T·∫£ *',
                labelDeposit: 'ƒê·∫∑t C·ªçc Ban ƒê·∫ßu (HLS) *',
                hintProposalType: 'ƒê·ªÅ xu·∫•t vƒÉn b·∫£n qu·∫£n tr·ªã chu·∫©n',
                hintTitle: 'T·ªëi ƒëa 200 k√Ω t·ª±',
                hintDescription: 'Gi·∫£i th√≠ch ƒë·ªÅ xu·∫•t c·ªßa b·∫°n chi ti·∫øt',
                hintDeposit: 'S·ªë ti·ªÅn ƒë·∫∑t c·ªçc t·ªëi thi·ªÉu ƒë·ªÉ g·ª≠i ƒë·ªÅ xu·∫•t',
                submitText: 'G·ª≠i ƒê·ªÅ Xu·∫•t',
                submitting: '‚è≥ ƒêang g·ª≠i...',
                loading: 'ƒêang t·∫£i ƒë·ªÅ xu·∫•t...',
                noProposals: 'Kh√¥ng C√≥ ƒê·ªÅ Xu·∫•t',
                noProposalsDesc: 'Hi·ªán t·∫°i ch∆∞a c√≥ ƒë·ªÅ xu·∫•t qu·∫£n tr·ªã n√†o.',
                votingEnded: 'B·ªè phi·∫øu ƒë√£ k·∫øt th√∫c',
                voteSuccess: 'B·ªé PHI·∫æU TH√ÄNH C√îNG!',
                proposalSuccess: 'T·∫†O ƒê·ªÄ XU·∫§T TH√ÄNH C√îNG!',
                proposal: 'ƒê·ªÅ Xu·∫•t',
                vote: 'Phi·∫øu',
                alreadyVoted: '‚úÖ ƒê√£ B·ªè Phi·∫øu',
                yourVote: 'Phi·∫øu C·ªßa B·∫°n',
                viewTx: 'Xem TX',
                checkDashboard: 'Ki·ªÉm Tra Dashboard',
                tagUnlock: 'Tag PROPOSAL_MASTER s·∫Ω m·ªü kh√≥a trong 1-24h!',
                errorMetaMask: '‚ùå MetaMask ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t!<br>T·∫£i t·∫°i: <a href="https://metamask.io" target="_blank" class="link">metamask.io</a>',
                errorConnect: '‚ùå L·ªói k·∫øt n·ªëi',
                switchingNetwork: '‚è≥ ƒêang chuy·ªÉn sang m·∫°ng Helios...',
                errorAddNetwork: '‚ùå Kh√¥ng th·ªÉ th√™m m·∫°ng Helios',
                errorSwitchNetwork: '‚ùå Kh√¥ng th·ªÉ chuy·ªÉn m·∫°ng',
                walletConnected: '‚úÖ V√≠ ƒê√£ K·∫øt N·ªëi',
                balance: 'üí∞ S·ªë D∆∞',
                txSent: '‚è≥ Giao d·ªãch ƒë√£ g·ª≠i! TX Hash',
                waitingConfirm: 'ƒêang ƒë·ª£i x√°c nh·∫≠n...',
                sending: '‚è≥ ƒêang g·ª≠i phi·∫øu',
                creatingProposal: '‚è≥ ƒêang t·∫°o ƒë·ªÅ xu·∫•t',
                for: 'cho',
                errorVote: '‚ùå L·ªói b·ªè phi·∫øu',
                errorProposal: '‚ùå L·ªói t·∫°o ƒë·ªÅ xu·∫•t',
                checkGas: 'üí° Ki·ªÉm tra xem v√≠ c√≥ ƒë·ªß HLS ƒë·ªÉ tr·∫£ gas kh√¥ng',
                connectFirst: '‚ùå Vui l√≤ng k·∫øt n·ªëi v√≠ tr∆∞·ªõc!',
                fillRequired: '‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!',
                loaded: '‚úÖ ƒê√£ t·∫£i',
                proposals: 'ƒë·ªÅ xu·∫•t',
                errorLoading: '‚ùå L·ªói khi t·∫£i ƒë·ªÅ xu·∫•t'
            }
        };

        const HELIOS_NETWORK = {
            chainId: '0xa410',
            chainName: 'Helios Testnet',
            rpcUrls: ['https://testnet1.helioschainlabs.org'],
            nativeCurrency: { name: 'HLS', symbol: 'HLS', decimals: 18 },
            blockExplorerUrls: ['https://explorer.helioschainlabs.org']
        };
        const GOV_CONTRACT = '0x0000000000000000000000000000000000000805';

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('helios-lang', lang);

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            updateTexts();
        }

        function switchTab(tab) {
            currentTab = tab;

            document.getElementById('voteTab').classList.toggle('active', tab === 'vote');
            document.getElementById('createTab').classList.toggle('active', tab === 'create');

            document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', (idx === 0 && tab === 'vote') || (idx === 1 && tab === 'create'));
            });
        }

        function updateTexts() {
            document.getElementById('pageTitle').textContent = t('pageTitle');
            document.getElementById('walletTitle').textContent = t('walletTitle');
            document.getElementById('tabVote').innerHTML = t('tabVote');
            document.getElementById('tabCreate').innerHTML = t('tabCreate');
            document.getElementById('proposalsTitle').textContent = t('proposalsTitle');
            document.getElementById('refreshText').textContent = t('refreshText');
            document.getElementById('createTitle').textContent = t('createTitle');
            document.getElementById('labelProposalType').textContent = t('labelProposalType');
            document.getElementById('labelTitle').textContent = t('labelTitle');
            document.getElementById('labelDescription').textContent = t('labelDescription');
            document.getElementById('labelDeposit').textContent = t('labelDeposit');
            document.getElementById('hintProposalType').textContent = t('hintProposalType');
            document.getElementById('hintTitle').textContent = t('hintTitle');
            document.getElementById('hintDescription').textContent = t('hintDescription');
            document.getElementById('hintDeposit').textContent = t('hintDeposit');
            document.getElementById('submitText').textContent = t('submitText');

            const connectBtn = document.getElementById('connectBtn');
            if (connectBtn.textContent.includes('Connected') || connectBtn.textContent.includes('K·∫øt N·ªëi')) {
                if (!connectBtn.textContent.includes('‚úÖ')) {
                    connectBtn.textContent = t('connectBtn');
                }
            } else {
                connectBtn.textContent = t('connectBtn');
            }

            const placeholder = document.getElementById('proposalPlaceholder');
            if (placeholder) {
                placeholder.textContent = t('proposalPlaceholder');
            }
        }

        window.onload = () => {
            switchLanguage(currentLang);
        };

        async function connectWallet() {
            const connectBtn = document.getElementById('connectBtn');
            const walletInfo = document.getElementById('walletInfo');

            if (typeof window.ethereum === 'undefined') {
                showStatus('error', t('errorMetaMask'));
                return;
            }

            try {
                connectBtn.disabled = true;
                connectBtn.textContent = t('connecting');

                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                walletAddress = await signer.getAddress();

                const network = await provider.getNetwork();
                const currentChainId = '0x' + network.chainId.toString(16);

                if (currentChainId !== HELIOS_NETWORK.chainId) {
                    showStatus('info', t('switchingNetwork'));

                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: HELIOS_NETWORK.chainId }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [HELIOS_NETWORK],
                                });
                            } catch (addError) {
                                showStatus('error', t('errorAddNetwork') + ': ' + addError.message);
                                connectBtn.disabled = false;
                                connectBtn.textContent = t('connectBtn');
                                return;
                            }
                        } else {
                            showStatus('error', t('errorSwitchNetwork') + ': ' + switchError.message);
                            connectBtn.disabled = false;
                            connectBtn.textContent = t('connectBtn');
                            return;
                        }
                    }

                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                }

                const balance = await provider.getBalance(walletAddress);

                // Load vote history for this wallet
                voteHistory = loadVoteHistory();

                walletInfo.innerHTML = `
                    <div class="wallet-info">
                        <div style="margin-bottom: 10px;">
                            <strong>${t('walletConnected')}</strong>
                            <span class="network-badge">Helios Testnet</span>
                        </div>
                        <div style="font-family: monospace; font-size: 0.9em; word-break: break-all; margin: 10px 0;">
                            üìç ${walletAddress}
                        </div>
                        <div>
                            ${t('balance')}: <strong>${ethers.utils.formatEther(balance)} HLS</strong>
                        </div>
                    </div>
                `;

                connectBtn.textContent = t('connected');
                connectBtn.style.background = '#4CAF50';
                document.getElementById('refreshBtn').disabled = false;
                document.getElementById('submitProposalBtn').disabled = false;

                if (currentTab === 'vote') {
                    await loadProposals();
                }

            } catch (error) {
                showStatus('error', `${t('errorConnect')}: ${error.message}`);
                connectBtn.disabled = false;
                connectBtn.textContent = t('connectBtn');
            }
        }

        async function loadProposals() {
            const container = document.getElementById('proposalsContainer');
            const refreshBtn = document.getElementById('refreshBtn');

            refreshBtn.disabled = true;
            container.innerHTML = `<div class="loading"><div class="spinner"></div><p>${t('loading')}</p></div>`;

            try {
                const response = await fetch('https://testnet1.helioschainlabs.org/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: 'eth_getProposalsByPageAndSizeWithFilter',
                        params: ['0x1', '0xa', ''],
                        id: 1
                    })
                });

                const data = await response.json();
                const proposals = data.result || [];

                if (!Array.isArray(proposals) || proposals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 3em; margin-bottom: 20px;">üì≠</div>
                            <h3>${t('noProposals')}</h3>
                            <p style="margin-top: 10px;">${t('noProposalsDesc')}</p>
                        </div>
                    `;
                    return;
                }

                displayProposals(proposals);
                showStatus('success', `${t('loaded')} ${proposals.length} ${t('proposals')}`);

            } catch (error) {
                container.innerHTML = `<div class="status status-error">‚ùå ${t('errorLoading')}: ${error.message}</div>`;
                showStatus('error', `‚ùå ${t('errorLoading')}: ${error.message}`);
            } finally {
                refreshBtn.disabled = false;
            }
        }

        function displayProposals(proposals) {
            const container = document.getElementById('proposalsContainer');

            const html = proposals.map(proposal => {
                const id = proposal.id;
                const isVotable = proposal.statusCode === 'PROPOSAL_STATUS_VOTING_PERIOD';
                const status = getStatusBadge(proposal.statusCode);
                const voted = hasVoted(id);
                const voteInfo = voted ? voteHistory[id] : null;

                return `
                    <div class="proposal-card ${voted ? 'voted' : (isVotable ? 'votable' : '')}">
                        <div class="proposal-header">
                            <div class="proposal-id">${t('proposal')} #${id}</div>
                            <div class="status-badge ${status.class}">${status.text}</div>
                        </div>
                        <div class="proposal-title">
                            <strong>${proposal.title || t('proposal') + ' ' + id}</strong>
                        </div>
                        ${isVotable ? (
                        voted ?
                            `<div class="voted-badge">
                                <div class="voted-badge-header">${t('alreadyVoted')}</div>
                                <div class="voted-badge-option">${t('yourVote')}: <strong>${voteInfo.optionName}</strong></div>
                                <div class="voted-badge-tx">
                                    <a href="https://explorer.helioschainlabs.org/tx/${voteInfo.txHash}" target="_blank" class="link">${t('viewTx')}</a>
                                </div>
                            </div>`
                            :
                            `<div class="vote-options">
                                <button class="vote-btn vote-yes" onclick="voteOnProposal(${id}, 1, this)">‚úÖ YES</button>
                                <button class="vote-btn vote-abstain" onclick="voteOnProposal(${id}, 2, this)">‚ö™ ABSTAIN</button>
                                <button class="vote-btn vote-no" onclick="voteOnProposal(${id}, 3, this)">‚ùå NO</button>
                                <button class="vote-btn vote-veto" onclick="voteOnProposal(${id}, 4, this)">üö´ VETO</button>
                            </div>`
                    ) : `<div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px; text-align: center; color: #999;">${t('votingEnded')}</div>`}
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        function getStatusBadge(status) {
            const map = {
                'PROPOSAL_STATUS_VOTING_PERIOD': { text: 'üü¢ VOTING', class: 'status-voting' },
                'PROPOSAL_STATUS_PASSED': { text: '‚úÖ PASSED', class: 'status-passed' },
                'PROPOSAL_STATUS_REJECTED': { text: '‚ùå REJECTED', class: 'status-rejected' },
                'PROPOSAL_STATUS_FAILED': { text: '‚ö†Ô∏è FAILED', class: 'status-other' }
            };
            return map[status] || { text: status, class: 'status-other' };
        }

        async function createProposal() {
            if (!signer) {
                showStatus('error', t('connectFirst'));
                return;
            }

            const title = document.getElementById('proposalTitle').value.trim();
            const description = document.getElementById('proposalDescription').value.trim();
            const deposit = document.getElementById('proposalDeposit').value;

            if (!title || !description || !deposit) {
                showStatus('error', t('fillRequired'));
                return;
            }

            const submitBtn = document.getElementById('submitProposalBtn');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = t('submitting');

                showStatus('info', `${t('creatingProposal')}...`);

                const address = await signer.getAddress();
                const msg = JSON.stringify({
                    "@type": "/helios.hyperion.v1.MsgUpdateOutTxTimeout",
                    "signer": address,
                    "chain_id": 11155111,
                    "target_batch_timeout": 3600000,
                    "target_outgoing_tx_timeout": 3600000
                });

                const depositAmount = ethers.utils.parseEther(deposit);

                const abi = ['function hyperionProposal(string title, string description, string msg, uint256 initialDepositAmount) external payable returns (uint64)'];
                const contract = new ethers.Contract(GOV_CONTRACT, abi, signer);

                const tx = await contract.hyperionProposal(title, description, msg, depositAmount, {
                    value: depositAmount
                });

                showStatus('info', `${t('txSent')}: <a href="https://explorer.helioschainlabs.org/tx/${tx.hash}" target="_blank" class="link">${tx.hash.slice(0, 20)}...</a><br>${t('waitingConfirm')}`);

                await tx.wait();

                showStatus('success', `
                    üéâ <strong>${t('proposalSuccess')}</strong><br><br>
                    üìã ${t('proposal')}: <strong>${title}</strong><br>
                    üí∞ Deposit: <strong>${deposit} HLS</strong><br>
                    üîó TX: <a href="https://explorer.helioschainlabs.org/tx/${tx.hash}" target="_blank" class="link">View on Explorer</a><br>
                    <br>
                    üí° ${t('checkDashboard')}: <a href="https://portal.helioschain.network/governance/proposals" target="_blank" class="link">View Proposal</a>
                `);

                document.getElementById('proposalTitle').value = '';
                document.getElementById('proposalDescription').value = '';
                document.getElementById('proposalDeposit').value = '10';

            } catch (error) {
                showStatus('error', `${t('errorProposal')}: ${error.message}<br><br>${t('checkGas')}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        async function voteOnProposal(proposalId, option, buttonElement) {
            if (!signer) {
                showStatus('error', t('connectFirst'));
                return;
            }

            const optionNames = ['', 'YES', 'ABSTAIN', 'NO', 'VETO'];
            const originalText = buttonElement.textContent;

            try {
                buttonElement.disabled = true;
                buttonElement.textContent = '‚è≥...';

                showStatus('info', `${t('sending')} ${optionNames[option]} ${t('for')} ${t('proposal')} #${proposalId}...`);

                const abi = ['function vote(address voter, uint64 proposalId, uint8 option, string metadata) external returns (bool)'];
                const contract = new ethers.Contract(GOV_CONTRACT, abi, signer);

                const voterAddress = await signer.getAddress();
                const metadata = `Vote on proposal ${proposalId}`;

                const tx = await contract.vote(voterAddress, proposalId, option, metadata);

                showStatus('info', `${t('txSent')}: <a href="https://explorer.helioschainlabs.org/tx/${tx.hash}" target="_blank" class="link">${tx.hash.slice(0, 20)}...</a><br>${t('waitingConfirm')}`);

                await tx.wait();

                // Save vote to history
                saveVote(proposalId, option, tx.hash);

                showStatus('success', `
                    üéâ <strong>${t('voteSuccess')}</strong><br><br>
                    üìã ${t('proposal')} #${proposalId}<br>
                    üéØ ${t('vote')}: <strong>${optionNames[option]}</strong><br>
                    üîó TX: <a href="https://explorer.helioschainlabs.org/tx/${tx.hash}" target="_blank" class="link">View on Explorer</a><br>
                    <br>
                    üèÜ <strong>${t('tagUnlock')}</strong><br>
                    üí° ${t('checkDashboard')}: <a href="https://testnet.helioschain.network" target="_blank" class="link">testnet.helioschain.network</a>
                `);

                // Reload proposals to show updated state
                await loadProposals();

            } catch (error) {
                showStatus('error', `${t('errorVote')}: ${error.message}<br><br>${t('checkGas')}`);
                buttonElement.disabled = false;
                buttonElement.textContent = originalText;
            }
        }

        function showStatus(type, message) {
            const container = document.getElementById('statusMessages');
            const statusClass = `status-${type}`;
            container.innerHTML = `<div class="status ${statusClass}">${message}</div>`;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>

</html>